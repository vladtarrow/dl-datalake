# Локальный Data Lake для рыночных данных (dl-datalake)

## Обзор
«dl-datalake» — это инфраструктура энтерпрайз-уровня для локального хранения и управления рыночными данными (крипто/форекс/акции). Проект спроектирован для работы на локальном оборудовании с ограниченными ресурсами (2-4 ГБ RAM), используя эффективные форматы хранения и партиционирования.

**Основная цель:** Обеспечить надежный прием, хранение, дедупликацию и доступ к историческим данным (1-минутные бары, тики, стакан) и результатам расчетов (фичи), без вычисления самих фич внутри этого модуля.

## Архитектура
*   **Хранилище**: Parquet (PyArrow) с партиционированием по `Exchange/Market/Symbol/Type/Period/YYYY/MM/DD`.
*   **Метаданные**: SQLite (`manifest.db`) для отслеживания версий файлов, контрольных сумм и происхождения данных.
*   **Оркестрация**: Prefect для управления пайплайнами загрузки (Ingest), архивации (Offload) и агрегации.
*   **Интерфейсы**: CLI (`dl`) и Python-клиент для взаимодействия.

## Структура проекта
```
src/dl-datalake/
├── data/           # Локальное хранилище данных (исключено из git)
├── manifest.db     # Реестр файлов и метаданных
├── src/
│   └── dl_datalake/
│       ├── cli.py            # CLI команды
│       ├── ingest/           # Логика загрузки (raw data)
│       ├── storage/          # Работа с Parquet и файловой системой
│       ├── metadata/         # Работа с SQLite манифестом
│       ├── orchestration/    # Prefect Flows
│       └── features/         # Feature Store (регистрация фич пользователя)
├── tests/
├── Dockerfile
└── Makefile
```

## Быстрый старт

### Установка
Требуется Python 3.10+.

```bash
pip install -r requirements.txt
```

### Использование CLI
```bash
# Инициализация (создание БД манифеста)
python -m dl_datalake.cli init

# Загрузка данных (пример)
python -m dl_datalake.cli ingest --source ./raw_data.csv --exchange BINANCE --symbol BTCUSDT

# Просмотр списка доступных данных
python -m dl_datalake.cli list --symbol BTCUSDT
```

## Разработка
Для запуска тестов:
```bash
pytest tests/
```
